<!DOCTYPE html>
<html>
<head>
    <title>–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">–ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞!</h1>
        <p class="text-center">–°–æ–∑–¥–∞—Ç–µ–ª—å: <span id="creator">{{ creator }}</span></p>

         <!-- –û–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Ä—ã -->
        <div class="row mt-4">
            <div class="col-md-6 offset-md-3">
                <div class="glass-card fade-in">
                    <h5 class="card-title">–ñ–¥–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–≥—Ä—ã üöÄ</h5>
                    <p class="card-text">
                        –ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤–∞—Å —Å–æ–±–µ—Ä–µ—Ç—Å—è –æ—Ç 2—Ö –¥–æ 4—Ö —á–µ–ª–æ–≤–µ–∫, —Å–æ–∑–¥–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –Ω–∞–∂–∞—Ç—å "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É". –ï—Å–ª–∏ –≤—ã –Ω–µ –Ω–∞—á–Ω–µ—Ç–µ –∏–≥—Ä—É –≤ —Ç–µ—á–µ–Ω–∏–∏ –ø—è—Ç–∏ –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –µ—ë —Å–æ–∑–¥–∞–Ω–∏—è, –æ–Ω–∞ –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω–∞ –∏ –≤—ã –≤–µ—Ä–Ω–µ—Ç–µ—Å—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω.
                    </p>
                    
                </div>
                <h3>–ü–æ–¥–∫–ª—é—á–∏–≤—à–∏–µ—Å—è –∏–≥—Ä–æ–∫–∏:</h3>
                <ul class="list-group" id="playerList"></ul>
                <button class="btn btn-success w-100 mt-3" id="startButton" style="display: none;" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io({ autoConnect: true });
        const gameId = '{{ game_id }}';
        const playerId = '{{ player_id }}';

        socket.on('connect', () => {
            console.log('–ü–æ–¥–∫–ª—é—á—ë–Ω —Å SID:', socket.id);
            socket.emit('update_sid', { game_id: gameId, player_id: playerId });
        });

        socket.on('update_players', (data) => {
            console.log('–ü–æ–ª—É—á–µ–Ω–æ update_players:', data);
            const playerList = document.getElementById('playerList');
            playerList.innerHTML = '';
            data.players.forEach(player => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.innerText = player;
                playerList.appendChild(li);
            });
            document.getElementById('creator').innerText = data.creator;
            const isCreator = data.is_creator;
            console.log('–Ø —Å–æ–∑–¥–∞—Ç–µ–ª—å?', isCreator);
            document.getElementById('startButton').style.display = isCreator ? 'block' : 'none';
        });

        socket.on('player_joined', (data) => {
            console.log('–ü–æ–ª—É—á–µ–Ω–æ player_joined:', data);
            const playerList = document.getElementById('playerList');
            playerList.innerHTML = '';
            data.players.forEach(player => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.innerText = player;
                playerList.appendChild(li);
            });
        });

        socket.on('start', (data) => {
            console.log('–ü–æ–ª—É—á–µ–Ω–æ start:', data);
            window.location.href = `/game/${data.game_id}/${data.player_id}`;
        });

        socket.on('error', (data) => {
            console.log('–ü–æ–ª—É—á–µ–Ω–æ error:', data);
            alert(data.message);
        });

        function startGame() {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É", –æ—Ç–ø—Ä–∞–≤–∫–∞ start_game —Å gameId:', gameId);
            socket.emit('start_game', { game_id: gameId });
        }
    </script>
    <script>
        socket.on('game_reset', (data) => {
            alert(data.message);
            window.location.href = '/';  // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        });
    </script>
</body>
</html>