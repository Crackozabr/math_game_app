<!DOCTYPE html>
<html>
<head>
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body {
            background-image: url('/static/background.png'); /* –§–æ–Ω —Å –æ–±–ª–∞–∫–∞–º–∏ –∏ –∑–≤—ë–∑–¥–∞–º–∏ */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            font-family: 'Arial', sans-serif;
            color: #2c3e50; /* –¢—ë–º–Ω–æ-—Å–∏–Ω–∏–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
        h1, h2, h3, h5, h6 {
            color: #2c3e50; /* –¢—ë–º–Ω–æ-—Å–∏–Ω–∏–π —Ü–≤–µ—Ç */
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.5); /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–Ω—å –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
        }
        h1 {
            font-size: 3rem;
            font-weight: bold;
            animation: fadeIn 1s ease-in-out;
        }
        h2 {
            font-size: 2rem;
            margin-bottom: 20px;
        }
        h3 {
            font-size: 1.5rem;
            margin-top: 20px;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Å—Ç–µ–∫–ª–∞ –¥–ª—è –±–ª–æ–∫–æ–≤ */
        .glass-card {
            background: rgba(255, 255, 255, 0.8); /* –ë–æ–ª–µ–µ –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –±–µ–ª—ã–π —Ñ–æ–Ω */
            border-radius: 15px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.3s ease-in-out;
        }
        .glass-card:hover {
            transform: translateY(-5px);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ */
        .card-text, ul, li {
            color: #2c3e50; /* –¢—ë–º–Ω–æ-—Å–∏–Ω–∏–π —Ü–≤–µ—Ç */
            font-size: 1rem;
        }
        .btn-link {
            color: #4a90e2; /* –ë–æ–ª–µ–µ —è—Ä–∫–∏–π —Å–∏–Ω–∏–π –¥–ª—è —Å—Å—ã–ª–æ–∫ */
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .btn-link:hover {
            color: #2c3e50;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –∏–≥—Ä */
        .list-group-item {
            background: rgba(255, 255, 255, 0.9); /* –ë–æ–ª–µ–µ –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #2c3e50;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: background 0.3s ease, transform 0.2s ease;
            cursor: pointer;
        }
        .list-group-item:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.02);
        }
        .list-group-item.active {
            background: rgba(40, 167, 69, 0.8); /* –ó–µ–ª—ë–Ω—ã–π –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∏–≥—Ä—ã */
            border-color: #28a745;
            color: #ffffff;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞ */
        .form-label {
            color: #2c3e50;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }
        .form-control {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: #2c3e50;
            border-radius: 8px;
            transition: background 0.3s ease;
        }
        .form-control:focus {
            background: rgba(255, 255, 255, 1);
            border-color: #4a90e2;
            box-shadow: 0 0 5px rgba(74, 144, 226, 0.5);
        }
        .form-control::placeholder {
            color: #6c757d;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .btn-primary, .btn-success {
            border-radius: 8px;
            padding: 12px 20px;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .btn-primary {
            background-color: #a1c4fd;
            border-color: #a1c4fd;
            color: #2c3e50;
        }
        .btn-primary:hover {
            background-color: #81a9ff;
            transform: translateY(-2px);
        }
        .btn-success {
            background-color: #c3e6cb;
            border-color: #c3e6cb;
            color: #155724;
        }
        .btn-success:hover {
            background-color: #a3d6ab;
            transform: translateY(-2px);
        }
        .btn-success:disabled {
            background-color: #d6d6d6;
            border-color: #d6d6d6;
            color: #6c757d;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 767.98px) {
            h1 {
                font-size: 2rem;
            }
            h2 {
                font-size: 1.5rem;
            }
            .glass-card {
                padding: 15px;
            }
            .btn-primary, .btn-success {
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">"–ú–∏—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤"</h1>
        <h2 class="text-center">–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞</h2>
        <div class="row mt-4">
            <div class="col-md-8 offset-md-2">
                <!-- –û–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Ä—ã -->
                <div class="glass-card fade-in">
                    <h5 class="card-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∫–∞—Ä—Ç–æ—á–Ω—É—é –∏–≥—Ä—É! üöÄ</h5>
                    <p class="card-text">
                        –í —ç—Ç–æ–π –∏–≥—Ä–µ –≤—ã —Å–æ—Ä–µ–≤–Ω—É–µ—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏, —Å–æ—Å—Ç–∞–≤–ª—è—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –∫–∞—Ä—Ç –≤ —Ä—É–∫–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —á–∏—Å–ª–∞, –ª–µ–∂–∞—â–∏–µ –Ω–∞ —Å—Ç–æ–ª–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∏ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, —á—Ç–æ–±—ã –Ω–∞–±—Ä–∞—Ç—å 15 –æ—á–∫–æ–≤ –∏ –ø–æ–±–µ–¥–∏—Ç—å!
                    </p>
                    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª -->
                    <button class="btn btn-link p-0 mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#rulesCollapse" aria-expanded="false" aria-controls="rulesCollapse">
                        –ü—Ä–∞–≤–∏–ª–∞ –∏ –º–µ—Ö–∞–Ω–∏–∫–∞
                    </button>
                    <div class="collapse" id="rulesCollapse">
                        <h6>–ü—Ä–∞–≤–∏–ª–∞ –∏ –º–µ—Ö–∞–Ω–∏–∫–∞:</h6>
                        <ul>
                            <li><strong>–¶–µ–ª—å:</strong> –ù–∞–±—Ä–∞—Ç—å 15 –æ—á–∫–æ–≤ –ø–µ—Ä–≤—ã–º.</li>
                            <li><strong>–û—á–∫–∏:</strong>
                                <ul>
                                    <li>2 –∫–∞—Ä—Ç—ã = 1 –æ—á–∫–æ.</li>
                                    <li>3 –∫–∞—Ä—Ç—ã (–°–ª–æ–∂–∏—Ç—å –∏–ª–∏ –£–º–Ω–æ–∂–∏—Ç—å) = 2 –æ—á–∫–∞.</li>
                                    <li>3 –∫–∞—Ä—Ç—ã —Å –æ–ø–µ—Ä–∞—Ü–∏–µ–π (A+B)*C –∏–ª–∏ A*B+C = 3 –æ—á–∫–∞.</li>
                                </ul>
                            </li>
                            <li><strong>–•–æ–¥ –∏–≥—Ä—ã:</strong>
                                <ul>
                                    <li>–ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç 5 –∫–∞—Ä—Ç —á–∏—Å–µ–ª. –ù–∞ —Å—Ç–æ–ª–µ –ª–µ–∂–∞—Ç 5 –∫–∞—Ä—Ç –æ—Ç–≤–µ—Ç–æ–≤.</li>
                                    <li>–í —Å–≤–æ–π —Ö–æ–¥ –≤—ã–±–µ—Ä–∏—Ç–µ 2 –∏–ª–∏ 3 –∫–∞—Ä—Ç—ã –∏–∑ —Ä—É–∫–∏ –∏ –æ–ø–µ—Ä–∞—Ü–∏—é (–°–ª–æ–∂–∏—Ç—å, –£–º–Ω–æ–∂–∏—Ç—å, (A+B)*C, A*B+C), —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —á–∏—Å–ª–æ –∏–∑ –∫–∞—Ä—Ç –Ω–∞ —Å—Ç–æ–ª–µ.</li>
                                    <li>–ï—Å–ª–∏ —Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω, –∫–∞—Ä—Ç—ã –∏–∑ —Ä—É–∫–∏ —É—Ö–æ–¥—è—Ç, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—á–∫–∏, –∞ —Ä—É–∫–∞ –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ 5.</li>
                                    <li>–ú–æ–∂–Ω–æ –≤–∑—è—Ç—å –∫–∞—Ä—Ç—É –∏–∑ –∫–æ–ª–æ–¥—ã –≤–º–µ—Å—Ç–æ —Ö–æ–¥–∞.</li>
                                </ul>
                            </li>
                            <li><strong>–ö–æ–Ω–µ—Ü –∏–≥—Ä—ã:</strong> –ü–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫, –Ω–∞–±—Ä–∞–≤—à–∏–π 15 –æ—á–∫–æ–≤, –ø–æ–±–µ–∂–¥–∞–µ—Ç. –ó–∞—Ç–µ–º –≤—Å–µ —Ä–µ—à–∞—é—Ç: —Å—ã–≥—Ä–∞—Ç—å –µ—â—ë –∏–ª–∏ –∑–∞–∫–æ–Ω—á–∏—Ç—å.</li>
                        </ul>
                    </div>
                    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è "–ö–∞–∫ –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É" -->
                    <button class="btn btn-link p-0 mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#howToStartCollapse" aria-expanded="false" aria-controls="howToStartCollapse">
                        –ö–∞–∫ –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É
                    </button>
                    <div class="collapse" id="howToStartCollapse">
                        <h6>–ö–∞–∫ –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É:</h6>
                        <ul>
                            <li><strong>–ù–æ–≤–∞—è –∏–≥—Ä–∞:</strong> –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É".</li>
                            <ul>
                                <li>–í—ã –ø–æ–ø–∞–¥–µ—Ç–µ –Ω–∞ —ç–∫—Ä–∞–Ω –æ–∂–∏–¥–∞–Ω–∏—è –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤.</li>
                                <li>–í—Å–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–≤—à–∏–µ—Å—è –∏–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–ø–∏—Å–∫–æ–º.</li>
                                <li>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç –¥–≤—É—Ö, –¥–æ —á–µ—Ç—ã—Ä—ë—Ö, –≤–∫–ª—é—á–∞—è –≤–∞—Å.</li>
                                <li>–ö–æ–≥–¥–∞ —Ä–µ—à–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É, - –Ω–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"</li>
                            </ul>
                            <li><strong>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ:</strong> –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∫ –∫–æ—Ç–æ—Ä–æ–π —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ"</li>
                            <ul>
                                <li>–í—ã –ø–æ–ø–∞–¥–µ—Ç–µ –Ω–∞ —ç–∫—Ä–∞–Ω –æ–∂–∏–¥–∞–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤.</li>
                                <li>–í—Å–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–≤—à–∏–µ—Å—è –∏–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–ø–∏—Å–∫–æ–º.</li>
                                <li>–ò–≥—Ä–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è, –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞—Ç–µ–ª—å –∏–≥—Ä—ã –Ω–∞—á–Ω–µ—Ç –∏–≥—Ä—É.</li>
                            </ul>
                        </ul>
                    </div>
                </div>

                <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ -->
                <div class="mb-3 fade-in">
                    <label for="playerName" class="form-label">–í–∞—à–µ –∏–º—è</label>
                    <input type="text" class="form-control" id="playerName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É" -->
                <button class="btn btn-primary w-100 mb-2 fade-in" onclick="createGame()">
                    <i class="bi bi-plus-circle me-2"></i> –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É
                </button>

                <!-- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–≥—Ä -->
                <h3 class="fade-in">–î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–≥—Ä—ã</h3>
                <ul class="list-group" id="gameList">
                    {% for game in games %}
                        <li class="list-group-item fade-in" onclick="selectGame('{{ game.id }}')" id="game_{{ game.id }}">
                            <i class="bi bi-controller me-2"></i> {{ game.creator }} (–ò–≥—Ä–æ–∫–æ–≤: {{ game.players }})
                        </li>
                    {% endfor %}
                </ul>

                <!-- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ" -->
                <button class="btn btn-success w-100 mt-2 fade-in" onclick="joinGame()" disabled id="joinButton">
                    <i class="bi bi-box-arrow-in-right me-2"></i> –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ
                </button>
            </div>
        </div>
    </div>

    <script>
        const socket = io({ autoConnect: true });
        let selectedGame = null;

        socket.on('connect', () => {
            console.log('–ü–æ–¥–∫–ª—é—á—ë–Ω —Å SID:', socket.id);
        });

        socket.on('game_created', (data) => {
            console.log(`–ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ —Å ID: ${data.game_id}`);
            window.location.href = `/waiting/${data.game_id}/${data.player_id}`;
        });

        socket.on('init', (data) => {
            console.log(`–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –∏–≥—Ä–µ ${data.game_id}`);
            window.location.href = `/waiting/${data.game_id}/${data.player_id}`;
        });

        socket.on('error', (data) => {
            alert(data.message);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∏–≥—Ä
        socket.on('update_games', (data) => {
            console.log('–ü–æ–ª—É—á–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä:', data);
            const gameList = document.getElementById('gameList');
            gameList.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫
            data.games.forEach(game => {
                if (game.state === 'waiting') { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–≥—Ä—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è
                    const li = document.createElement('li');
                    li.className = 'list-group-item fade-in';
                    li.id = `game_${game.id}`;
                    li.innerHTML = `<i class="bi bi-controller me-2"></i> ${game.creator} (–ò–≥—Ä–æ–∫–æ–≤: ${Object.keys(game.players).length})`;
                    li.onclick = () => selectGame(game.id);
                    gameList.appendChild(li);
                }
            });
            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –∏–≥—Ä–∞ –±–æ–ª—å—à–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
            if (selectedGame && !data.games.some(game => game.id === selectedGame && game.state === 'waiting')) {
                selectedGame = null;
                document.getElementById('joinButton').disabled = true;
            }
        });

        function createGame() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è!');
                return;
            }
            socket.emit('create_game', { name: name });
        }

        function selectGame(gameId) {
            document.querySelectorAll('#gameList li').forEach(li => li.classList.remove('active'));
            document.getElementById(`game_${gameId}`).classList.add('active');
            selectedGame = gameId;
            document.getElementById('joinButton').disabled = false;
        }

        function joinGame() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è!');
                return;
            }
            if (!selectedGame) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É!');
                return;
            }
            socket.emit('join_game', { name: name, game_id: selectedGame });
        }
    </script>
</body>
</html>